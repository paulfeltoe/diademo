<div class="funnel-container">
    <!-- Progress Header -->
    <div class="progress-header">
        <button id="backButton" class="back-button" onclick="funnelPreviousStep()" disabled>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
        </button>
        <button id="closeButton" class="back-button" onclick="closeBottomSheet()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
        </button>
    </div>

    <!-- Question Container -->
    <div class="question-container">
        <!-- Steps will be shown/hidden based on current step -->
        <div class="step" data-step="1">
            <h1>What can we help you with today?</h1>
            <div class="search-container">
                <textarea 
                    id="symptomsInput"
                    class="search-input" 
                    placeholder="Describe your symptoms here..."
                    rows="4"
                ></textarea>
                <div class="char-count">0/500 characters</div>
                
                <!-- Container for extracted symptom tags -->
                <div id="extractedTags" class="tags-container">
                    <!-- Tags will be dynamically inserted here -->
                </div>
                
                <!-- Container for suggested related symptoms -->
                <div id="suggestedTags" class="suggested-tags-container">
                    <p>Are you experiencing any of these additional symptoms?</p>
                    <div class="tags-wrapper">
                        <!-- Suggested tags will be dynamically inserted here -->
                    </div>
                </div>
            </div>


            <div class="button-container">
                <button class="primary-button" onclick="funnelNextStep()" disabled>Continue</button>
            </div>

        </div>

        <!-- New follow-up questions -->
        <div class="step" data-step="2" style="display: none;">
            <h1>How long have you been experiencing these symptoms?</h1>
            <p>This helps us better understand your situation</p>
            
            <div class="question-group">
                <div class="option-buttons">
                    <button class="option-btn" onclick="funnelNextStep()">Less than a week</button>
                    <button class="option-btn" onclick="funnelNextStep()">1-2 weeks</button>
                    <button class="option-btn" onclick="funnelNextStep()">More than 2 weeks</button>
                    <button class="option-btn" onclick="funnelNextStep()">It comes and goes</button>
                </div>
            </div>
        </div>

        <div class="step" data-step="3" style="display: none;">
            <h1>What color is your nasal discharge?</h1>
            <p>This can help indicate the type of issue</p>
            
            <div class="option-buttons">
                <button class="option-btn" onclick="funnelNextStep()">Clear</button>
                <button class="option-btn" onclick="funnelNextStep()">Yellow</button>
                <button class="option-btn" onclick="funnelNextStep()">Green</button>
                <button class="option-btn" onclick="funnelNextStep()">Not sure</button>
            </div>
        </div>

        <div class="step" data-step="4" style="display: none;">
            <h1>How would you describe the intensity of your symptoms?</h1>
            <p>This helps us understand the severity of your condition</p>
            <div class="question-group"></div>
                <div class="option-buttons">
                    <button class="option-btn" onclick="funnelNextStep()">Mild - Noticeable but not interfering with daily activities</button>
                    <button class="option-btn" onclick="funnelNextStep()">Moderate - Somewhat limiting daily activities</button>
                    <button class="option-btn" onclick="funnelNextStep()">Severe - Significantly impacting daily activities</button>
                    <button class="option-btn" onclick="funnelNextStep()">Variable - Symptoms come and go or change in intensity</button>
                </div>
            </div>

            <!-- <div class="button-container">
                <button onclick="funnelNextStep()">Continue</button>
            </div> -->
        

        <!-- Step 6 becomes step 5 -->
        <div class="step" data-step="5" style="display: none;">
            <h1>We recommend a Video Consultation</h1>
            <p>Recommended within 24 hours to address your sinus symptoms.</p>
                    
            <div class="why-section">
                <h3>Why?</h3>
                <p>Based on the symptoms you've described, it's important to have them evaluated soon. Upper respiratory symptoms can impact your daily life and may worsen without proper care. A video consultation will allow our specialists to properly assess your symptoms, understand their severity, and recommend appropriate next steps for relief.</p>
            </div>
            <div class="button-container">
                <button class="special-button" onclick="funnelNextStep()"><i class="fa-regular fa-calendar"></i> Book Consultation Now</button>
            </div>
        </div>

        <div class="step" data-step="6" style="display: none;">
            <h1>Choose an Appointment Time</h1>
            
            <div class="week-selector">
                <button class="week-nav prev" aria-label="Previous week">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
                
                <div class="days-container" id="daysContainer">
                    <!-- Days will be dynamically inserted by JavaScript -->
                </div>

                <button class="week-nav next" aria-label="Next week">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M9 18l6-6-6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>

            <div class="time-slots" id="timeSlots">
                <!-- Time slots will be dynamically inserted by JavaScript -->
            </div>
        </div>

        <div class="step" data-step="7" style="display: none;">
            <h1>Let's Review Your Information</h1>
            <p>Editing this information will also update your profile</p>

            <div class="info-section required">
                <h2>About You <span class="required-tag">Required</span></h2>
                <div class="info-grid">
                    <div class="info-item" data-field="name">
                        <div class="info-header">
                            <span class="label">Full Name</span>
                            <button class="edit-button" onclick="toggleEdit(this)">Edit</button>
                        </div>
                        <div class="info-content">
                            <span class="value"></span>
                            <input type="text" class="edit-input" style="display: none">
                            <p class="edit-notice" style="display: none">Editing this information will also update your profile</p>
                        </div>
                    </div>

                    <div class="info-item" data-field="dob">
                        <div class="info-header">
                            <span class="label">Date of Birth</span>
                            <button class="edit-button" onclick="toggleEdit(this)">Edit</button>
                        </div>
                        <div class="info-content">
                            <span class="value"></span>
                            <input type="date" class="edit-input" style="display: none">
                            <p class="edit-notice" style="display: none">Editing this information will also update your profile</p>
                        </div>
                    </div>

                    <div class="info-item" data-field="phone">
                        <div class="info-header">
                            <span class="label">Phone</span>
                            <button class="edit-button" onclick="toggleEdit(this)">Edit</button>
                        </div>
                        <div class="info-content">
                            <span class="value"></span>
                            <input type="tel" class="edit-input" style="display: none">
                            <p class="edit-notice" style="display: none">Editing this information will also update your profile</p>
                        </div>
                    </div>

                    <div class="info-item" data-field="insurance">
                        <div class="info-header">
                            <span class="label">Insurance</span>
                            <button class="edit-button" onclick="toggleEdit(this)">Edit</button>
                        </div>
                        <div class="info-content">
                            <span class="value"></span>
                            <input type="text" class="edit-input" style="display: none">
                            <p class="edit-notice" style="display: none">Editing this information will also update your profile</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="info-section required">
                <h2>Medical History <span class="required-tag">Required</span></h2>
                <div class="info-grid">
                    <div class="info-item" data-field="medications">
                        <div class="info-header">
                            <span class="label">Current Medications</span>
                            <button class="edit-button" onclick="toggleEdit(this)">Edit</button>
                        </div>
                        <div class="info-content">
                            <div class="tags"></div>
                            <textarea class="edit-input" style="display: none"></textarea>
                            <p class="edit-notice" style="display: none">Editing this information will also update your profile</p>
                        </div>
                    </div>

                    <div class="info-item" data-field="allergies">
                        <div class="info-header">
                            <span class="label">Allergies</span>
                            <button class="edit-button" onclick="toggleEdit(this)">Edit</button>
                        </div>
                        <div class="info-content">
                            <div class="tags"></div>
                            <textarea class="edit-input" style="display: none"></textarea>
                            <p class="edit-notice" style="display: none">Editing this information will also update your profile</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="button-container">
                <button class="continue-button special-button" onclick="funnelNextStep()">Continue</button>
            </div>
        </div>

        <div class="step" data-step="8" style="display: none;">
            <div class="confirmation-container">
                <div class="confirmation-header">
                    <div class="success-icon">
                        <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                            <circle cx="24" cy="24" r="24" fill="#E3F2FD"/>
                            <path d="M20 27.17L16.83 24L15.41 25.41L20 30L32 18L30.59 16.59L20 27.17Z" fill="#2196F3"/>
                        </svg>
                    </div>
                    <h1>Your Appointment is Confirmed!</h1>
                    <p>We've got everything we need. Here's what you can expect next.</p>
                </div>

                <div class="appointment-details">
                    <div class="detail-item">
                        <span class="label">Appointment Type</span>
                        <span class="value">Video Consultation with Dr. Smith</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Date & Time</span>
                        <span class="value" id="appointmentDateTime"></span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Location</span>
                        <span class="value">Join via the Dialogue app</span>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="primary-button calendar-button special-button" onclick="handleCalendarClick()">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M15.8333 2.5H15V1.66667H13.3333V2.5H6.66667V1.66667H5V2.5H4.16667C3.24167 2.5 2.5 3.25 2.5 4.16667V15.8333C2.5 16.75 3.24167 17.5 4.16667 17.5H15.8333C16.75 17.5 17.5 16.75 17.5 15.8333V4.16667C17.5 3.25 16.75 2.5 15.8333 2.5ZM15.8333 15.8333H4.16667V6.66667H15.8333V15.8333Z" fill="currentColor"/>
                        </svg>
                        Add to my calendar
                    </button>
                    <!-- <button class="secondary-button waitlist-button" onclick="window.location.href='phone-lock.html'">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M9.99 0C4.47 0 0 4.48 0 10C0 15.52 4.47 20 9.99 20C15.52 20 20 15.52 20 10C20 4.48 15.52 0 9.99 0ZM10 18C5.58 18 2 14.42 2 10C2 5.58 5.58 2 10 2C14.42 2 18 5.58 18 10C18 14.42 14.42 18 10 18ZM9.78 5H9.72C9.32 5 9 5.32 9 5.72V10.44C9 10.79 9.18 11.12 9.49 11.3L13.64 13.79C13.98 13.99 14.42 13.89 14.62 13.55C14.83 13.21 14.72 12.76 14.37 12.56L10.5 10.26V5.72C10.5 5.32 10.18 5 9.78 5Z" fill="currentColor"/>
                        </svg>
                        Join waitlist for sooner time
                    </button> -->
                    
                </div>
            </div>
        </div>

        <div class="step step-outreferral" data-step="outreferral" style="display: none;">
            <div class="step-content">
                <h2>Additional Support Needed</h2>
                <p>Based on your symptoms, we recommend scheduling with a specialist for a more comprehensive evaluation.</p>
                
                <div class="info-box">
                    <h3>Why are we recommending this?</h3>
                    <p>Some headache conditions require specialized care and treatment approaches. A specialist can provide:</p>
                    <ul>
                        <li>Detailed neurological evaluation</li>
                        <li>Advanced treatment options</li>
                        <li>Specialized pain management strategies</li>
                        <li>Long-term care planning</li>
                    </ul>
                </div>

                <div class="button-container">
                    <button onclick="handleOutreferralNext()" class="primary-button">
                        Find Available Specialists
                    </button>
                </div>
            </div>
        </div>

        <div class="step step-outreferral-clinics" data-step="outreferral-clinics" style="display: none;">
            <h2>Available Specialists Near You</h2>
            <p class="subtitle">We've found several specialists who can help with your condition</p>
            
            <div class="filters-container">
                <div class="filter-group">
                    <label>Distance</label>
                    <select class="filter-select" onchange="filterClinics()">
                        <option value="5">Within 5 miles</option>
                        <option value="10">Within 10 miles</option>
                        <option value="25">Within 25 miles</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Wait Time</label>
                    <select class="filter-select" onchange="filterClinics()">
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="twoweeks">Next 2 Weeks</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Rating</label>
                    <select class="filter-select" onchange="filterClinics()">
                        <option value="4">4+ Stars</option>
                        <option value="3">3+ Stars</option>
                        <option value="all">All Ratings</option>
                    </select>
                </div>
            </div>

            <div class="clinics-list">
                <div class="clinic-card" onclick="handleClinicSelection(1)">
                    <div class="clinic-info">
                        <h3>Neurological Center of Excellence</h3>
                        <div class="rating">★★★★★ 4.8 (234 reviews)</div>
                        <p>1.2 miles away • Next available: Today</p>
                    </div>
                </div>
                <div class="clinic-card" onclick="handleClinicSelection(2)">
                    <div class="clinic-info">
                        <h3>Advanced Headache Institute</h3>
                        <div class="rating">★★★★☆ 4.2 (156 reviews)</div>
                        <p>2.5 miles away • Next available: Tomorrow</p>
                    </div>
                </div>
                <div class="clinic-card" onclick="handleClinicSelection(3)">
                    <div class="clinic-info">
                        <h3>City Neurology Partners</h3>
                        <div class="rating">★★★★★ 4.9 (89 reviews)</div>
                        <p>3.8 miles away • Next available: This Week</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="step step-outreferral-details" data-step="outreferral-details" style="display: none;">
            <div class="provider-details">
                <button class="back-link" onclick="funnelPreviousStep()">← Back to list</button>
                
                <div class="provider-header">
                    <h2>Neurological Center of Excellence</h2>
                    <div class="rating">★★★★★ 4.8 (234 reviews)</div>
                    <p>1.2 miles away • 123 Medical Drive, Suite 100</p>
                </div>

                <div class="provider-info">
                    <h3>About the Practice</h3>
                    <p>Specialized in treating complex neurological conditions with a focus on patient-centered care. Our team of board-certified specialists provides comprehensive evaluations and personalized treatment plans.</p>
                    
                    <h3>Meet Your Provider</h3>
                    <div class="provider-profile">
                        <!-- <img src="doctor-avatar.jpg" alt="Dr. Sarah Smith" class="provider-avatar"> -->
                        <div class="provider-bio">
                            <h4>Dr. Sarah Smith, MD</h4>
                            <p>Board Certified Neurologist with 15+ years of experience in treating complex headache conditions.</p>
                        </div>
                    </div>
                    
                    <h3>Available Appointments</h3>
                    <div class="appointment-slots">
                        <button class="time-slot">Today at 2:30 PM</button>
                        <button class="time-slot">Today at 4:15 PM</button>
                        <button class="time-slot">Tomorrow at 9:00 AM</button>
                        <button class="time-slot">Tomorrow at 11:30 AM</button>
                    </div>

                </div>
            </div>
        </div>

        <div class="step step-outreferral-confirmation" data-step="outreferral-confirmation" style="display: none;">
            <div class="confirmation-container">
                <div class="success-icon">
                    <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                        <circle cx="24" cy="24" r="24" fill="#E3F2FD"/>
                        <path d="M20 27.17L16.83 24L15.41 25.41L20 30L32 18L30.59 16.59L20 27.17Z" fill="#2196F3"/>
                    </svg>
                </div>
                
                <h2>Your Appointment is Confirmed!</h2>
                <p>We've scheduled your visit with Dr. Sarah Smith at Neurological Center of Excellence.</p>
                
                <div class="appointment-details">
                    <div class="detail-item">
                        <span class="label">Date & Time</span>
                        <span class="value" id="confirmedDateTime">Today at 2:30 PM</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Location</span>
                        <span class="value">123 Medical Drive, Suite 100</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Provider</span>
                        <span class="value">Dr. Sarah Smith, MD</span>
                    </div>
                </div>

                <div class="follow-up-message">
                    <p>We'll check in with you in a few days to see how it went.</p>
                </div>

                <div class="action-buttons">
                    <button class="primary-button" onclick="handleOutreferralComplete()">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M15.8333 2.5H15V1.66667H13.3333V2.5H6.66667V1.66667H5V2.5H4.16667C3.24167 2.5 2.5 3.25 2.5 4.16667V15.8333C2.5 16.75 3.24167 17.5 4.16667 17.5H15.8333C16.75 17.5 17.5 16.75 17.5 15.8333V4.16667C17.5 3.25 16.75 2.5 15.8333 2.5Z" fill="currentColor"/>
                        </svg>
                        Add to Calendar
                    </button>
                </div>
            </div>
        </div>

    </div>
</div>
