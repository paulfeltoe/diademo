<div class="funnel-container">
    <!-- Progress Header -->
    <div class="progress-header">
        <button id="backButton" class="back-button" onclick="funnelPreviousStep()" disabled>‚Üê</button>
        <!-- <div class="progress-bar-container">
            <div id="progressBar" class="progress-bar" style="width: 10%;">
                <span id="progressText">Step 1 of 10</span>
            </div>
        </div> -->
        <button id="closeButton" class="close-button" onclick="closeBottomSheet()">√ó</button>
    </div>

    <!-- Question Container -->
    <div class="question-container">
        <!-- Steps will be shown/hidden based on current step -->
        <div class="step" data-step="1">
            <h2>What can we help you with today?</h2>
            <div class="search-container">
                <textarea 
                    id="symptomsInput"
                    class="search-input" 
                    placeholder="Describe your symptoms here..."
                    rows="4"
                ></textarea>
                <div class="char-count">0/500 characters</div>
                
                <!-- Container for extracted symptom tags -->
                <div id="extractedTags" class="tags-container">
                    <!-- Tags will be dynamically inserted here -->
                </div>
                
                <!-- Container for suggested related symptoms -->
                <div id="suggestedTags" class="suggested-tags-container">
                    <h4>Are you experiencing any of these additional symptoms?</h4>
                    <div class="tags-wrapper">
                        <!-- Suggested tags will be dynamically inserted here -->
                    </div>
                </div>
            </div>
    
            

            <!-- <div class="suggested-journeys">
                <h3>Try these journeys</h3>
                <div class="condition-buttons">
                    <button class="condition-btn" data-condition="sinusitis">
                        <span class="condition-icon">ü§ß</span>
                        <span class="condition-text">Sinus</span>
                    </button>
                    <button class="condition-btn" data-condition="anxiety">
                        <span class="condition-icon">üò∞</span>
                        <span class="condition-text">Anxiety</span>
                    </button>
                    <button class="condition-btn" data-condition="rash">
                        <span class="condition-icon">üî¥</span>
                        <span class="condition-text">Skin & Rash</span>
                    </button>
                    <button class="condition-btn" data-condition="outreferral">
                        <span class="condition-icon">üè•</span>
                        <span class="condition-text">Outreferral</span>
                    </button>
                </div>
            </div> -->


            <div class="button-container">
                <button onclick="funnelNextStep()" disabled>Continue</button>
            </div>

        </div>

        <!-- New follow-up questions -->
        <div class="step" data-step="2" style="display: none;">
            <h2>Let's get some more details about your symptoms</h2>
            <p class="subtitle">This helps us better understand your situation</p>
            
            <div class="question-group">
                <h3>How long have you been experiencing these symptoms?</h3>
                <div class="option-buttons">
                    <button class="option-btn" onclick="funnelNextStep()">Less than a week</button>
                    <button class="option-btn" onclick="funnelNextStep()">1-2 weeks</button>
                    <button class="option-btn" onclick="funnelNextStep()">More than 2 weeks</button>
                    <button class="option-btn" onclick="funnelNextStep()">It comes and goes</button>
                </div>
            </div>
        </div>

        <div class="step" data-step="3" style="display: none;">
            <h2>What color is your nasal discharge?</h2>
            <p class="subtitle">This can help indicate the type of infection</p>
            
            <div class="option-buttons">
                <button class="option-btn" onclick="funnelNextStep()">Clear</button>
                <button class="option-btn" onclick="funnelNextStep()">Yellow</button>
                <button class="option-btn" onclick="funnelNextStep()">Green</button>
                <button class="option-btn" onclick="funnelNextStep()">Not sure</button>
            </div>
        </div>

        <div class="step" data-step="4" style="display: none;">
            <h2>How would you describe the intensity of your symptoms?</h2>
            <p class="subtitle">This helps us understand the severity of your condition</p>
            
            <div class="checkbox-group">
                <label class="checkbox-option">
                    <input type="checkbox" name="severity" value="mild">
                    Mild - Noticeable but not interfering with daily activities
                </label>
                <label class="checkbox-option">
                    <input type="checkbox" name="severity" value="moderate">
                    Moderate - Somewhat limiting daily activities
                </label>
                <label class="checkbox-option">
                    <input type="checkbox" name="severity" value="severe">
                    Severe - Significantly impacting daily activities
                </label>
                <label class="checkbox-option">
                    <input type="checkbox" name="severity" value="variable">
                    Variable - Symptoms come and go or change in intensity
                </label>
            </div>

            <div class="button-container">
                <button onclick="funnelNextStep()">Continue</button>
            </div>
        </div>

        <!-- Step 6 becomes step 5 -->
        <div class="step" data-step="5" style="display: none;">
            <!-- <h2>Your Personalized Recommendation</h2>
            <p class="subtitle">Based on what you've shared, here's what we believe is the best next step for you.</p>
             -->
            <div class="recommendation-card">
                <div class="recommendation-content">
                    <h3>We recommend a Video Consultation</h3>
                    <p class="timing">Recommended within 24 hours to address your sinus symptoms.</p>
                    
                    <div class="why-section">
                        <h4>Why?</h4>
                        <p>Based on the symptoms you've described, it's important to have them evaluated soon. Upper respiratory symptoms can impact your daily life and may worsen without proper care. A video consultation will allow our specialists to properly assess your symptoms, understand their severity, and recommend appropriate next steps for relief.</p>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="book-now" onclick="funnelNextStep()">BOOK NOW</button>
                    </div>
                </div>
            </div>

            <!-- <div class="alternative-options">
                <h4>Other options you might consider:</h4>
                <ul>
                    <li>
                        <a href="#" class="option-link">
                            <span class="option-icon">üìö</span>
                            Learn more about common sinus issues
                        </a>
                    </li>
                    <li>
                        <a href="#" class="option-link">
                            <span class="option-icon">‚ú®</span>
                            Natural remedies for sinus relief
                        </a>
                    </li>
                </ul>
            </div> -->
        </div>

        <div class="step" data-step="6" style="display: none;">
            <h2>Choose an Appointment Time</h2>
            
            <div class="week-selector">
                <button class="week-nav prev" aria-label="Previous week">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
                
                <div class="days-container" id="daysContainer">
                    <!-- Days will be dynamically inserted by JavaScript -->
                </div>

                <button class="week-nav next" aria-label="Next week">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M9 18l6-6-6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>

            <div class="time-slots" id="timeSlots">
                <!-- Time slots will be dynamically inserted by JavaScript -->
            </div>
        </div>

        <div class="step" data-step="7" style="display: none;">
            <h2>Let's Review Your Information</h2>
            <p class="edit-notice">Editing this information will also update your profile</p>

            <div class="info-section required">
                <h3>About You <span class="required-tag">Required</span></h3>
                <div class="info-grid">
                    <div class="info-item" data-field="name">
                        <div class="info-header">
                            <span class="label">Full Name</span>
                            <button class="edit-button" onclick="toggleEdit(this)">Edit</button>
                        </div>
                        <div class="info-content">
                            <span class="value"></span>
                            <input type="text" class="edit-input" style="display: none">
                            <p class="edit-notice" style="display: none">Editing this information will also update your profile</p>
                        </div>
                    </div>

                    <div class="info-item" data-field="dob">
                        <div class="info-header">
                            <span class="label">Date of Birth</span>
                            <button class="edit-button" onclick="toggleEdit(this)">Edit</button>
                        </div>
                        <div class="info-content">
                            <span class="value"></span>
                            <input type="date" class="edit-input" style="display: none">
                            <p class="edit-notice" style="display: none">Editing this information will also update your profile</p>
                        </div>
                    </div>

                    <div class="info-item" data-field="phone">
                        <div class="info-header">
                            <span class="label">Phone</span>
                            <button class="edit-button" onclick="toggleEdit(this)">Edit</button>
                        </div>
                        <div class="info-content">
                            <span class="value"></span>
                            <input type="tel" class="edit-input" style="display: none">
                            <p class="edit-notice" style="display: none">Editing this information will also update your profile</p>
                        </div>
                    </div>

                    <div class="info-item" data-field="insurance">
                        <div class="info-header">
                            <span class="label">Insurance</span>
                            <button class="edit-button" onclick="toggleEdit(this)">Edit</button>
                        </div>
                        <div class="info-content">
                            <span class="value"></span>
                            <input type="text" class="edit-input" style="display: none">
                            <p class="edit-notice" style="display: none">Editing this information will also update your profile</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="info-section required">
                <h3>Medical History <span class="required-tag">Required</span></h3>
                <div class="info-grid">
                    <div class="info-item" data-field="medications">
                        <div class="info-header">
                            <span class="label">Current Medications</span>
                            <button class="edit-button" onclick="toggleEdit(this)">Edit</button>
                        </div>
                        <div class="info-content">
                            <div class="tags"></div>
                            <textarea class="edit-input" style="display: none"></textarea>
                            <p class="edit-notice" style="display: none">Editing this information will also update your profile</p>
                        </div>
                    </div>

                    <div class="info-item" data-field="allergies">
                        <div class="info-header">
                            <span class="label">Allergies</span>
                            <button class="edit-button" onclick="toggleEdit(this)">Edit</button>
                        </div>
                        <div class="info-content">
                            <div class="tags"></div>
                            <textarea class="edit-input" style="display: none"></textarea>
                            <p class="edit-notice" style="display: none">Editing this information will also update your profile</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="info-section optional">
                <h3>Custom <span class="optional-tag">Optional</span></h3>
                <div class="info-grid">
                    <div class="info-item" data-field="smoker">
                        <div class="info-header">
                            <span class="label">Smoking Status</span>
                            <button class="edit-button" onclick="toggleEdit(this)">Edit</button>
                        </div>
                        <div class="info-content">
                            <span class="value">Non-smoker</span>
                            <select class="edit-input" style="display: none">
                                <option value="non-smoker">Non-smoker</option>
                                <option value="former">Former smoker</option>
                                <option value="current">Current smoker</option>
                            </select>
                            <p class="edit-notice" style="display: none">Editing this information will also update your profile</p>
                        </div>
                    </div>

                    <div class="info-item" data-field="stress">
                        <div class="info-header">
                            <span class="label">Stress Level</span>
                            <button class="edit-button" onclick="toggleEdit(this)">Edit</button>
                        </div>
                        <div class="info-content">
                            <span class="value">Moderate</span>
                            <select class="edit-input" style="display: none">
                                <option value="low">Low</option>
                                <option value="moderate" selected>Moderate</option>
                                <option value="high">High</option>
                            </select>
                            <p class="edit-notice" style="display: none">Editing this information will also update your profile</p>
                        </div>
                    </div>

                    <div class="info-item" data-field="conversation">
                        <div class="info-header">
                            <span class="label">Preferred Conversation Style</span>
                            <button class="edit-button" onclick="toggleEdit(this)">Edit</button>
                        </div>
                        <div class="info-content">
                            <span class="value">Direct and brief</span>
                            <select class="edit-input" style="display: none">
                                <option value="direct">Direct and brief</option>
                                <option value="detailed">Detailed and thorough</option>
                                <option value="casual">Casual and friendly</option>
                            </select>
                            <p class="edit-notice" style="display: none">Editing this information will also update your profile</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="button-container">
                <button class="continue-button" onclick="funnelNextStep()">Continue</button>
            </div>
        </div>

        <div class="step" data-step="8" style="display: none;">
            <div class="confirmation-container">
                <div class="confirmation-header">
                    <div class="success-icon">
                        <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                            <circle cx="24" cy="24" r="24" fill="#E3F2FD"/>
                            <path d="M20 27.17L16.83 24L15.41 25.41L20 30L32 18L30.59 16.59L20 27.17Z" fill="#2196F3"/>
                        </svg>
                    </div>
                    <h2>Your Appointment is Confirmed!</h2>
                    <p class="subtitle">We've got everything we need. Here's what you can expect next.</p>
                </div>

                <div class="appointment-details">
                    <div class="detail-item">
                        <span class="label">Appointment Type</span>
                        <span class="value">Video Consultation with Dr. Smith</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Date & Time</span>
                        <span class="value" id="appointmentDateTime"></span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Location</span>
                        <span class="value">Join via the Dialogue app</span>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="primary-button calendar-button" onclick="handleCalendarClick()">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M15.8333 2.5H15V1.66667H13.3333V2.5H6.66667V1.66667H5V2.5H4.16667C3.24167 2.5 2.5 3.25 2.5 4.16667V15.8333C2.5 16.75 3.24167 17.5 4.16667 17.5H15.8333C16.75 17.5 17.5 16.75 17.5 15.8333V4.16667C17.5 3.25 16.75 2.5 15.8333 2.5ZM15.8333 15.8333H4.16667V6.66667H15.8333V15.8333Z" fill="currentColor"/>
                        </svg>
                        Add to my calendar
                    </button>
                    <!-- <button class="secondary-button waitlist-button" onclick="window.location.href='phone-lock.html'">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M9.99 0C4.47 0 0 4.48 0 10C0 15.52 4.47 20 9.99 20C15.52 20 20 15.52 20 10C20 4.48 15.52 0 9.99 0ZM10 18C5.58 18 2 14.42 2 10C2 5.58 5.58 2 10 2C14.42 2 18 5.58 18 10C18 14.42 14.42 18 10 18ZM9.78 5H9.72C9.32 5 9 5.32 9 5.72V10.44C9 10.79 9.18 11.12 9.49 11.3L13.64 13.79C13.98 13.99 14.42 13.89 14.62 13.55C14.83 13.21 14.72 12.76 14.37 12.56L10.5 10.26V5.72C10.5 5.32 10.18 5 9.78 5Z" fill="currentColor"/>
                        </svg>
                        Join waitlist for sooner time
                    </button> -->
                    <button class="text-button cancel-button" onclick="handleFunnelCancel()">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M15.8333 5.34167L14.6583 4.16667L10 8.825L5.34167 4.16667L4.16667 5.34167L8.825 10L4.16667 14.6583L5.34167 15.8333L10 11.175L14.6583 15.8333L15.8333 14.6583L11.175 10L15.8333 5.34167Z" fill="currentColor"/>
                        </svg>
                        Cancel appointment
                    </button>
                </div>
            </div>
        </div>

        <div class="step step-outreferral" style="display: none;">
            <div class="step-content">
                <h2>Additional Support Needed</h2>
                <p>Based on your symptoms, we recommend scheduling with a specialist for a more comprehensive evaluation.</p>
                
                <div class="info-box">
                    <h3>Why are we recommending this?</h3>
                    <p>Some headache conditions require specialized care and treatment approaches. A specialist can provide:</p>
                    <ul>
                        <li>Detailed neurological evaluation</li>
                        <li>Advanced treatment options</li>
                        <li>Specialized pain management strategies</li>
                        <li>Long-term care planning</li>
                    </ul>
                </div>

                <div class="button-container">
                    <button onclick="window.location.href='https://example.com/specialist-referral'" class="primary-button">
                        Schedule with Specialist
                    </button>
                </div>
            </div>
        </div>

    </div>
</div>
